       
       
<%- include('header') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<br>
    <br>
    <br>
<div class="row">
    <div class="col-lg-1">
        
    </div>
    
    <div class=" col-lg-11">
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Order detail</h2>
                    <p>Details for Order ID: 3453012</p>
                </div>
            </div>
            <div class="card">
                <header class="card-header">
                    <div class="row align-items-center">
                        <div class="col-lg-6 col-md-6 mb-lg-0 mb-15">
                            <span>
                                <i class="material-icons md-calendar_today"></i> <b>Wed, Aug 13, 2022, 4:34PM</b>
                            </span> <br>
                            <small class="text-muted">Order ID: 3453012</small>
                        </div>
                        <div class="col-lg-6 col-md-6 ms-auto text-md-end">
                          
                            <a class="btn btn-primary" href="/api/user/invoice?id=<%= order._id%>">invoice</a>
                            <% if (order.status=='pending') { %>
                                <a onclick="conformCansel('<%= order.product[0]._id %>','<%= order._id %>')" class="btn btn-md rounded font-sm">Cancel</a>
                            <% } else if(order.status == 'conformed'){ %>
                                <a onclick="conformCansel('<%= order.product[0]._id %>','<%= order._id %>')" class="btn btn-md rounded font-sm">Cancel</a>
                               

                                <% } else if(order.status == 'canceled'){ %>
                                    <% } else if(order.status == 'shipped'){ %>
                                        <a onclick="conformCansel('<%= order.product[0]._id %>','<%= order._id %>')" class="btn btn-md rounded font-sm">Cancel</a>
                                        


<% } else if(order.status == 'delivered'){ %>
<a onclick="conformReturn('<%= order.product[0]._id %>','<%= order._id %>')" class="btn btn-md rounded font-sm">Return</a>
<% } else if(order.status=='returned'){ %>

<% } %> 


<!-- Return Reason Modal
<div class="modal fade" id="returnModal" tabindex="-1" aria-labelledby="returnModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="returnModalLabel">Return Reason</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <textarea id="returnReason" class="form-control" placeholder="Write your return reason here..."></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="submitReturnReason()">Submit</button>
        </div>
      </div>
    </div>
  </div>

<!-- end of modal------------------------------------------------------------------ -->
 


                        </div>
                    </div>
                </header> <!-- card-header end// -->
                <div class="card-body">
                    <div class="row mb-50 mt-20 order-info-wrap">
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-person"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Customer</h6>
                                    <p class="mb-1">
                                        <%= user.username %> <br> <%= user.email %><br> +1<%= user.mobile %>
                                    </p>
                                    <a href="/api/user/profile">View profile</a>
                                </div>
                            </article>
                        </div> <!-- col// -->
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-local_shipping"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Order info</h6>
                                    <p class="mb-1">
                                        
                                        Shipping:<%= order.address[0].adressType %>  <br> Pay method:<%= order.payment %>  <br> Status: 
                                        <span class="badge rounded-pill alert-success text-success">
                                        <% if(order.status=="returned"){%>Returned<%}%>
                                        <% if(order.status=="pending"){%>Pending<%}%>
                                        <% if(order.status=="canceled"){%>Canceled<%}%>
                                        <% if(order.status=="delivered"){%>Delivered<%}%>
                                        <% if(order.status=="returnreject"){%>Return Rejected<%}%>
                                        <% if(order.status=="shipped"){%>Shipped<%}%>
                                        <% if(order.status=="conformed"){%>Confirmed<%}%>
                                        </span>
                                        
                                    </p>
                                    
                                </div>
                            </article>
                        </div> <!-- col// -->
                        <div class="col-md-4">
                            <article class="icontext align-items-start">
                                <span class="icon icon-sm rounded-circle bg-primary-light">
                                    <i class="text-primary material-icons md-place"></i>
                                </span>
                                <div class="text">
                                    <h6 class="mb-1">Deliver to</h6>
                                    <p class="mb-1">
                                        City: <%= order.address[0].townCity %> <br> <%= order.address[0].addressLine %> <br> Po Box <%= order.address[0]. pinCode %> <br>
                                    <!-- <a href="#">View profile</a> -->
                                </div>
                            </article>
                        </div> <!-- col// -->
                    </div> <!-- row // -->
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th width="40%">Product</th>
                                            <th width="20%">Unit Price</th>
                                            <th width="20%">Quantity</th>
                                            <th width="20%" class="text-end">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>




                                        <% for (let i=0; i < order.product.length;i++) { %>
                                            <tr>
                                                <td>
                                                    <a class="itemside" href="#">
                                                        <div class="left">
                                                           
                                                            <img src="/admin/assets/imgs/category/<%=order.product[i].image %>" width="40" height="40" class="img-xs" alt="Item">
                                                            
                                                        </div>
                                                        <div class="info"> <%= order.product[i].title %> </div>
                                                    </a>
                                                </td>



                                       

                                               
                                                   
                                                    <td><%= order.product[i].price %></td>
                                                    <td> x<%=order.product[i].quantity  %></td>
                                                    <td>â‚¹<%= order.product[i].price *order.product[i].quantity %></td>
                                                    
                                            </tr>
                                        


                                            <% } %> 
                                      
                                        
                                        
                                        
                                        <tr>
                                            <td colspan="4">
                                                <article class="float-end">
                                                    <dl class="dlist">
                                                        <dt>Subtotal:</dt>
                                                        <dd>â‚¹<%= (order.totalPrice).toFixed(2) %></dd>
                                                    </dl>
                                                    <dl class="dlist">
                                                        <dt>Shipping cost:</dt>
                                                        <dd>â‚¹10.00</dd>
                                                    </dl>
                                                    <dl class="dlist">
                                                        <dt>Grand total:</dt>
                                                        <dd> <b class="h5">â‚¹<%= (order.totalPrice+10.00).toFixed(2) %></b> </dd>
                                                    </dl>
                                                    <dl class="dlist">
                                                        <dt class="text-muted">Status: </dt>
                                                        <dd>
                                                            <span class="badge rounded-pill alert-success text-success">
                                                                 <% if(order.status=="returned"){%>Returned<%}%>
                                                                <% if(order.status=="pending"){%>Pending<%}%>
                                                                <% if(order.status=="canceled"){%>Canceled<%}%>
                                                                <% if(order.status=="delivered"){%>Delivered<%}%>
                                                                <% if(order.status=="returnreject"){%>Return Rejected<%}%>
                                                                <% if(order.status=="shipped"){%>Shipped<%}%>
                                                                <% if(order.status=="conformed"){%>Confirmed<%}%></span>
                                                        </dd>
                                                    </dl>
                                                </article>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div> <!-- table-responsive// -->
                            <a class="btn btn-primary" href="/api/user/allOrderDetails">View Orders</a>
                            <a class="btn btn-primary" href="/api/user/index">Continue Shoping</a>

                        </div> <!-- col// -->
                        <div class="col-lg-1"></div>
                        <div class="col-lg-4">
                            <div class="box shadow-sm bg-light">
                                <h6 class="mb-15">Payment info</h6>
                                <p>
                                    <img src="/admin/assets/imgs/card-brands/2.png" class="border" height="20"> <%= order.payment %> <br>
                                    Business name: Grand Market LLC <br>
                                    Phone: +1 (800) 555-154-52
                                </p>
                            </div>
                           
                            
                           
                        </div> <!-- col// -->
                       
                    </div>
                    
                </div> <!-- card-body end// -->
               
            </div> <!-- card end// -->
        </section> <!-- content-main end// -->
    </div>
</div>
<br>
<br>
<br>
<br>
    <br>
    <br>


    


    <script>
        function conformReturn(id,orderId){

            
           
        swal({
        title: "Are you sure?",
        text: "Once Return, you will not be able to recover this Product!",
        icon: "warning",
        content: {
        element: "input",
        attributes: {
        placeholder: "Enter Return Reason",
        }},
        buttons: true,
        dangerMode: true,
        })


        .then((willDelete) => 
        {
            
            
        if (willDelete) {
            
        swal("Poof! Your imaginary file has been deleted!", {
        icon: "success",
        });
             location.href=`/api/user/return?id=${id}&orderId=${orderId}`
        } else {
            
            if(willDelete == ""){
                Swal.fire({
                              title: "Please enter return reason",
                             
                              icon: "error",
                              timer: 1000,
                              showConfirmButton: false, // This removes the button
                            });
                
            }
            else{
                Swal.fire({
                              title: "Return Cancel Success",
                             
                              icon: "error",
                              timer: 1000,
                              showConfirmButton: false, // This removes the button
                            });

            }
            
        }
        });
        
        }
        </script>
        
        <script>
        function conformCansel(id,orderId){
            swal({
        title: "Are you sure?",
        text: "Once Cansel, you will not be able to recover this Product!",
        icon: "warning",
        buttons: true,
        dangerMode: true,
        })
        .then((willDelete) => {
        if (willDelete) {
        swal("Poof! Your imaginary file has been deleted!", {
        icon: "success",
        });
            location.href=`/api/user/cancelOrder?id=${id}&orderId=${orderId}`
        } else {
            Swal.fire({
                              title: "Cansel Success",
                             
                              icon: "error",
                              timer: 1000,
                              showConfirmButton: false, // This removes the button
                            });
        }
        });
        
        }
        
        
        
        </script>
  
  
    <%- include('footer') %>
    